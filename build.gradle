plugins {
    id 'application'
    id 'com.github.johnrengelman.shadow' version '7.1.2'
}

sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

mainClassName = 'org.mcphackers.mcp.main.MainCLI'

repositories {
    mavenCentral()
    maven { url 'https://jitpack.io' }
    maven { url 'https://maven.fabricmc.net/' }
    flatDir {
        dirs "libs"
    }
}

dependencies {
    // Required libraries
    implementation "org.ow2.asm:asm:${project.asm_version}"
    implementation "org.ow2.asm:asm-analysis:${project.asm_version}"
    implementation "org.ow2.asm:asm-commons:${project.asm_version}"
    implementation "org.ow2.asm:asm-tree:${project.asm_version}"
    implementation "org.ow2.asm:asm-util:${project.asm_version}"

    implementation "com.github.MCPHackers:RetroFernflower:${project.fernflower_version}"
    implementation "com.github.MCPHackers:RetroDebugInjector:${project.rdi_version}"
    implementation "org.fusesource.jansi:jansi:${project.jansi_version}"
    implementation "org.json:json:${project.json_version}"
    implementation "com.github.MCPHackers:DiffPatch:${project.diffpatch_version}"
    implementation "net.fabricmc:mapping-io:${project.mapping_io_version}"
}

application {
    // Redirect all execution into the testing folder
    mainClass = mainClassName
    executableDir = 'test'
    mkdir(executableDir)
}

shadowJar {
    minimize()
}

run {
    workingDir 'test'
}

runShadow {

}

task jarGUI(type: Jar) {
	manifest {
		attributes 'Main-Class': 'org.mcphackers.mcp.main.MainGUI'
	}
	archiveClassifier = 'GUI'
	with shadowJar
}

task jarCLI(type: Jar) {
	manifest {
		attributes 'Main-Class': 'org.mcphackers.mcp.main.MainCLI'
	}
	archiveClassifier = 'CLI'
	with shadowJar
}

jar.dependsOn(jarCLI)
jar.dependsOn(jarGUI)
